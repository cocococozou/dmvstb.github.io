---
title: "complications_DZ"
author: "DZ"
date: "November 14, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(ggthemes)
theme_set(theme_classic())
library(plotly)
```



```{r, warning=FALSE}
load('./dm.Rdata')
df <- dm_base %>% 
  rename(retina = reti, skin = derm, vessel = vesl, nerve = neur,kidney = neph, depression = depress, gender = xingbie ) %>%
  mutate(retina = as.numeric(retina),
         skin = as.numeric(skin),
         vessel = as.numeric(vessel),
         nerve = as.numeric(nerve),
         kidney = as.numeric(kidney)) %>% 
  mutate(complications = retina + skin + vessel + nerve + kidney + depression) %>%
  mutate(complications = as.factor(complications))

```


```{r, warning=FALSE, message=FALSE}
plot_ret<-ggplotly(ggplot(df, aes(x = dmage, y = retina, colour=dmage)) +
    geom_histogram(stat = "identity", width = .6) +
    labs(title="The complication of retina with diabetes age",
         x = "dmage") +
    theme(axis.title.x =  element_blank(),
          axis.text.x  =  element_blank(), 
          axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=10),
          legend.title = element_text(size=12, face="bold"),
          legend.text = element_text(size = 12, face = "bold"))+
    facet_wrap(~gender))

plot_ret
```



```{r, warning=FALSE, message=FALSE}

plot_skin<-ggplotly(ggplot(df, aes(x = dmage, y = skin, colour=dmage)) +
    geom_histogram(stat = "identity", width = .6) +
    labs(title="The complication of Skin with diabetes age",
         x = "dmage") +
    theme(axis.title.x =  element_blank(),
          axis.text.x  =  element_blank(), 
          axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=10),
          legend.title = element_text(size=12, face="bold"),
          legend.text = element_text(size = 12, face = "bold"))+
    facet_wrap(~gender))
  
ggplotly(plot_skin)

```


```{r, warning=FALSE, message=FALSE}
plot_vess<-ggplot(df, aes(x = dmage, y = vessel, color=dmage)) + 
                              geom_histogram(stat = "identity", width = .6) +
                              facet_grid(. ~ gender)
                              labs(title="The complication of Vessel with diabetes age") +
                              theme_tufte() +  
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank())
ggplotly(plot_vess)
```


```{r, warning=FALSE, message=FALSE}
plot_nerve<-ggplot(df, aes(x = dmage, y = nerve, color=dmage)) + 
                              geom_bar(stat = "identity", width = .6) +
                              facet_grid(. ~ gender)
                              labs(title="The complication of Nerve with diabetes age") +
                              theme_tufte() +  
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank())
ggplotly(plot_nerve)
```


```{r, warning=FALSE, message=FALSE}

plot_kidney<-ggplot(df, aes(x = dmage, y = kidney, color=dmage)) + 
                              geom_bar(stat = "identity", width = .6) +
                              facet_grid(. ~ gender)
                              labs(title="The complication of Kidney with diabetes age") +
                              theme_tufte() +  
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank())
ggplotly(plot_kidney)

```


```{r, warning=FALSE, message=FALSE}
plot_depress<-ggplot(df, aes(x = dmage, y = depression, color=dmage)) + 
                              geom_bar(stat = "identity", width = .6) +
                              facet_grid(. ~ gender)
                              labs(title="The complication of Depression with diabetes age") +
                              theme_tufte() +  
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank())
ggplotly(plot_depress)
```


```{r, warning=FALSE, message=FALSE}
levels(df$complications) <- list(none=0,one=1,more_than_two=c(2:6))
freqtable <- table(df$complications)
df_com<- as.data.frame.table(freqtable) %>% 
  rename(complications = Var1)
head(df_com)

plot_com2<-ggplotly(ggplot(df_com, aes(x = complications, y = Freq, fill=complications)) +
    geom_histogram(stat = "identity", width = .6) +
    labs(title="The Frequency of complications",
          x = "How many complications for diabetes patients",
           y = "Frequency") +
    theme(axis.title.x =  element_blank(),
          axis.text.x  =  element_blank(), 
          axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=10),
          legend.title = element_text(size=12, face="bold"),
          legend.text = element_text(size = 12, face = "bold")))
plot_com2
```

